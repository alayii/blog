---
title: 「汇编语言」第 3 版环境搭建
date: 2019-01-05T16:23:36.239Z
draft: false
---
最近在看王爽的「汇编语言」第 3 版，这本书的评价是很好的，刚读两章，里面对一些概念的讲解确实清晰易懂，很适合对汇编或者底层有兴趣的程序员来看。

但是书是基于 8086 CPU 来讲解的，也就是 16 位 CPU，现在基本已经普及 64 位了，16 位的程序并不能直接运行起来，所以如果要看懂本书，并且实践的实验或者检测点，则先要搭建好开发环境，书中并没有提及如何搭建这类环境，因之前是可以直接在 Windows 2000 这类系统上直接跑起来的。

我的机器是 Windows 10 家庭版，然后还有一个 Ubuntu 18.04 的虚拟机，都是 64 位系统，但是 8086 CPU 16 位的指令只能在 DOS 系统上运行。

一开始以为汇编语言为了兼容，可以在 64 位机器上将 `rax` 这类寄存器写成 `ax` 即可，因为「汇编语言」中说明了 `ah`, `al` 是 `ax` 的高位和低位，所以产生了会兼容的错觉，实际上这样 nasm 是无法编译的。

既然是需要模拟 8086 的 CPU，因此找到了 [emu8086](https://softfamous.com/emu8086/)，可以在 Windows 上运行的 8086 模拟器。

这个模拟器非常符合「汇编语言」中的需求，因为可以直接输入汇编指令，而不需要管任何 nasm 或者 masm 的语法，就能进行单步调试，看见每步执行后寄存器内的值。

![emu8086 screenshot](/images/uploads/emu8086.png "emu8086 screenshot")

这样第一章上的检测点基本都可以通过这个模拟器来实践。

emu8086 也提供了第二章需要的 `debug` 程序，但是无法输入 `a` 命令，原因未知。

freeDOS 也许是更完善的方案，但是还是要安装虚拟机，于是选择了在 Ubuntu 内安装了 `dosemu`，也是一个 DOS 的模拟器，但是安装更简单。

```
sudo apt install dosemu
```

然后在命令行内输入 `dosemu` 即可启动了，里面带了 `debug` 这个程序，所以可以完美地使用它来完成第二章的实验等。

因此总结下来，需要用到的系统和程序是：

1. Windows
2. Ubuntu
3. 运行在 Windows 上的 emu8086 模拟器
4. 运行在 Ubuntu 上的 dosemu

看起来有点绕，也暂时没有找到更简单的方式，但是这个组合 work 得很好。

后面貌似要用上 masm，虽然 Windows 上还有 [masm32 SDK](http://www.masm32.com/) 可以用，但现在还用不上，就还没有去了解如何使用，之后看看如何将 masm 或者替代的方法（如果有的话）跑起来。

最后说道，「汇编语言」这本书着实不错（虽还只看了前两章），对 CPU 的讲解有让人茅塞顿开的感觉，推荐之。
